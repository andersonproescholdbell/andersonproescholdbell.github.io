---
import type { ColorName } from '../config/colors';
import { getColorForPlaceholder } from '../config/colors';
import { Github } from 'lucide-astro';

// Helper function to create placeholders.dev URLs with consistent font sizing
function createPlaceholderUrl(title: string, color: ColorName): string {
  const selectedColors = getColorForPlaceholder(color);

  // 2. Build the URL using URLSearchParams for all options
  const params = new URLSearchParams({
    width: '600',
    height: '400',
    text: title,
    fontSize: '80',
    bgColor: selectedColors.bgColor,
    textColor: selectedColors.textColor,
  });
  
  // 3. Use the correct base URL with the "images" subdomain
  return `https://images.placeholders.dev/?${params.toString()}`;
}

export interface Props {
  title: string;
  description: string;
  link: string;
  image?: string;
  placeholderText?: string;
  tags: string[];
  color: ColorName;
}

const { title, description, link, image, placeholderText, tags, color } = Astro.props;

// Generate placeholder image if no explicit image provided
// Use placeholderText if provided, otherwise fall back to title
const finalImage = image || createPlaceholderUrl(placeholderText || title, color);

// Check if this is an external GitHub link
const isExternalGitHub = link.startsWith('https://github.com/');

const hoverShadowClasses = {
  // Original colors
  sky: 'hover:shadow-sky-500/20',
  emerald: 'hover:shadow-emerald-500/20',
  red: 'hover:shadow-red-500/20',
  indigo: 'hover:shadow-indigo-500/20',
  purple: 'hover:shadow-purple-500/20',
  amber: 'hover:shadow-amber-500/20',
  pink: 'hover:shadow-pink-500/20',
  // New colors
  blue: 'hover:shadow-blue-500/20',
  cyan: 'hover:shadow-cyan-500/20',
  teal: 'hover:shadow-teal-500/20',
  green: 'hover:shadow-green-500/20',
  lime: 'hover:shadow-lime-500/20',
  yellow: 'hover:shadow-yellow-500/20',
  orange: 'hover:shadow-orange-500/20',
  rose: 'hover:shadow-rose-500/20',
  fuchsia: 'hover:shadow-fuchsia-500/20',
  violet: 'hover:shadow-violet-500/20',
  slate: 'hover:shadow-slate-500/20',
  gray: 'hover:shadow-gray-500/20',
  zinc: 'hover:shadow-zinc-500/20',
  neutral: 'hover:shadow-neutral-500/20',
  stone: 'hover:shadow-stone-500/20',
  // 400 variants
  'sky-400': 'hover:shadow-sky-400/20',
  'blue-400': 'hover:shadow-blue-400/20',
  'indigo-400': 'hover:shadow-indigo-400/20',
  'purple-400': 'hover:shadow-purple-400/20',
  'pink-400': 'hover:shadow-pink-400/20',
  'rose-400': 'hover:shadow-rose-400/20',
  'red-400': 'hover:shadow-red-400/20',
  'orange-400': 'hover:shadow-orange-400/20',
  'amber-400': 'hover:shadow-amber-400/20',
  'yellow-400': 'hover:shadow-yellow-400/20',
  'lime-400': 'hover:shadow-lime-400/20',
  'green-400': 'hover:shadow-green-400/20',
  'emerald-400': 'hover:shadow-emerald-400/20',
  'teal-400': 'hover:shadow-teal-400/20',
  'cyan-400': 'hover:shadow-cyan-400/20',
  // New diverse colors
  burgundy: 'hover:shadow-red-900/20',
  navy: 'hover:shadow-blue-900/20',
  forest: 'hover:shadow-green-900/20',
  maroon: 'hover:shadow-red-800/20',
  crimson: 'hover:shadow-red-600/20',
  mahogany: 'hover:shadow-orange-800/20',
  coral: 'hover:shadow-orange-400/20',
  turquoise: 'hover:shadow-cyan-400/20',
  magenta: 'hover:shadow-pink-500/20',
  chartreuse: 'hover:shadow-lime-400/20',
  vermillion: 'hover:shadow-red-500/20',
  bronze: 'hover:shadow-yellow-600/20',
  copper: 'hover:shadow-orange-600/20',
  seagreen: 'hover:shadow-teal-600/20',
  royalblue: 'hover:shadow-blue-600/20',
  darkviolet: 'hover:shadow-purple-700/20',
  steelblue: 'hover:shadow-blue-500/20',
  mint: 'hover:shadow-green-300/20',
  peach: 'hover:shadow-orange-200/20',
  lavender: 'hover:shadow-purple-300/20',
  salmon: 'hover:shadow-pink-300/20',
  gold: 'hover:shadow-yellow-500/20',
  plum: 'hover:shadow-purple-800/20',
  olive: 'hover:shadow-green-700/20',
  chocolate: 'hover:shadow-yellow-700/20',
  firebrick: 'hover:shadow-red-700/20',
  darkcyan: 'hover:shadow-cyan-700/20'
};

const tagBgClasses = {
  // Original colors
  sky: 'bg-sky-900',
  emerald: 'bg-emerald-900',
  red: 'bg-red-900',
  indigo: 'bg-indigo-900',
  purple: 'bg-purple-900',
  amber: 'bg-amber-900',
  pink: 'bg-pink-900',
  // New colors
  blue: 'bg-blue-900',
  cyan: 'bg-cyan-900',
  teal: 'bg-teal-900',
  green: 'bg-green-900',
  lime: 'bg-lime-900',
  yellow: 'bg-yellow-900',
  orange: 'bg-orange-900',
  rose: 'bg-rose-900',
  fuchsia: 'bg-fuchsia-900',
  violet: 'bg-violet-900',
  slate: 'bg-slate-900',
  gray: 'bg-gray-900',
  zinc: 'bg-zinc-900',
  neutral: 'bg-neutral-900',
  stone: 'bg-stone-900',
  // 400 variants
  'sky-400': 'bg-sky-900',
  'blue-400': 'bg-blue-900',
  'indigo-400': 'bg-indigo-900',
  'purple-400': 'bg-purple-900',
  'pink-400': 'bg-pink-900',
  'rose-400': 'bg-rose-900',
  'red-400': 'bg-red-900',
  'orange-400': 'bg-orange-900',
  'amber-400': 'bg-amber-900',
  'yellow-400': 'bg-yellow-900',
  'lime-400': 'bg-lime-900',
  'green-400': 'bg-green-900',
  'emerald-400': 'bg-emerald-900',
  'teal-400': 'bg-teal-900',
  'cyan-400': 'bg-cyan-900',
  // New diverse colors
  burgundy: 'bg-red-900',
  navy: 'bg-blue-900',
  forest: 'bg-green-900',
  maroon: 'bg-red-900',
  crimson: 'bg-red-900',
  mahogany: 'bg-orange-900',
  coral: 'bg-orange-900',
  turquoise: 'bg-cyan-900',
  magenta: 'bg-pink-900',
  chartreuse: 'bg-lime-900',
  vermillion: 'bg-red-900',
  bronze: 'bg-yellow-900',
  copper: 'bg-orange-900',
  seagreen: 'bg-teal-900',
  royalblue: 'bg-blue-900',
  darkviolet: 'bg-purple-900',
  steelblue: 'bg-blue-900',
  mint: 'bg-green-900',
  peach: 'bg-orange-900',
  lavender: 'bg-purple-900',
  salmon: 'bg-pink-900',
  gold: 'bg-yellow-900',
  plum: 'bg-purple-900',
  olive: 'bg-green-900',
  chocolate: 'bg-yellow-900',
  firebrick: 'bg-red-900',
  darkcyan: 'bg-cyan-900'
};

const tagTextClasses = {
  // Original colors
  sky: 'text-sky-300',
  emerald: 'text-emerald-300',
  red: 'text-red-300',
  indigo: 'text-indigo-300',
  purple: 'text-purple-300',
  amber: 'text-amber-300',
  pink: 'text-pink-300',
  // New colors
  blue: 'text-blue-300',
  cyan: 'text-cyan-300',
  teal: 'text-teal-300',
  green: 'text-green-300',
  lime: 'text-lime-300',
  yellow: 'text-yellow-300',
  orange: 'text-orange-300',
  rose: 'text-rose-300',
  fuchsia: 'text-fuchsia-300',
  violet: 'text-violet-300',
  slate: 'text-slate-300',
  gray: 'text-gray-300',
  zinc: 'text-zinc-300',
  neutral: 'text-neutral-300',
  stone: 'text-stone-300',
  // 400 variants
  'sky-400': 'text-sky-300',
  'blue-400': 'text-blue-300',
  'indigo-400': 'text-indigo-300',
  'purple-400': 'text-purple-300',
  'pink-400': 'text-pink-300',
  'rose-400': 'text-rose-300',
  'red-400': 'text-red-300',
  'orange-400': 'text-orange-300',
  'amber-400': 'text-amber-300',
  'yellow-400': 'text-yellow-300',
  'lime-400': 'text-lime-300',
  'green-400': 'text-green-300',
  'emerald-400': 'text-emerald-300',
  'teal-400': 'text-teal-300',
  'cyan-400': 'text-cyan-300',
  // New diverse colors
  burgundy: 'text-red-300',
  navy: 'text-blue-300',
  forest: 'text-green-300',
  maroon: 'text-red-300',
  crimson: 'text-red-300',
  mahogany: 'text-orange-300',
  coral: 'text-orange-300',
  turquoise: 'text-cyan-300',
  magenta: 'text-pink-300',
  chartreuse: 'text-lime-300',
  vermillion: 'text-red-300',
  bronze: 'text-yellow-300',
  copper: 'text-orange-300',
  seagreen: 'text-teal-300',
  royalblue: 'text-blue-300',
  darkviolet: 'text-purple-300',
  steelblue: 'text-blue-300',
  mint: 'text-green-300',
  peach: 'text-orange-300',
  lavender: 'text-purple-300',
  salmon: 'text-pink-300',
  gold: 'text-yellow-300',
  plum: 'text-purple-300',
  olive: 'text-green-300',
  chocolate: 'text-yellow-300',
  firebrick: 'text-red-300',
  darkcyan: 'text-cyan-300'
};

const hoverColor = hoverShadowClasses[color];
const tagBgColor = tagBgClasses[color];
const tagTextColor = tagTextClasses[color];
---

<a href={link}
  class={`group block bg-gray-800 rounded-lg shadow-lg ${hoverColor} hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 overflow-hidden h-full flex flex-col relative`}>
  {isExternalGitHub && (
    <div class="absolute top-3 right-3 z-10 github-icon">
      <Github size={16} />
    </div>
  )}
  <div>
    <img src={finalImage}
      alt={`Screenshot of ${title}`}
      class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"
      onerror="this.onerror=null;this.src='https://placeholders.dev/600x400/1f2937/ffffff?text=Project+Image&fontSize=64';">
  </div>
  <div class="p-6 flex flex-col h-full">
    <div>
      <h3 class="text-xl font-bold mb-2 text-white">{title}</h3>
      <p class="text-gray-400 mb-4">{description}</p>
    </div>
    <div class="flex flex-wrap gap-2 mt-auto">
      {tags.map(tag => (
        <span class:list={[
            'text-xs font-semibold px-2 py-1 rounded-full',
            tag === 'WIP' 
              ? 'bg-yellow-900 text-yellow-300' 
              : `${tagBgColor} ${tagTextColor}`
        ]}>
          {tag}
        </span>
      ))}
    </div>
  </div>
</a>

<style>
  .github-icon {
    color: #d1d5db; /* text-gray-300 */
    transition: all 0.2s ease;
    background-color: rgba(17, 24, 39, 0.8); /* semi-transparent bg-gray-900 */
    border-radius: 0.375rem; /* rounded-md */
    padding: 0.375rem; /* p-1.5 */
    backdrop-filter: blur(4px);
  }

  .group:hover .github-icon {
    color: #60a5fa; /* text-blue-400 */
    background-color: rgba(96, 165, 250, 0.1);
  }
</style>